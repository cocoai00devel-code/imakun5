<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>AI キャラクター連続対話テスト</title>
<style>
  body { font-family: sans-serif; padding: 20px; background: #fdf6e3; }
  textarea { width: 100%; height: 60px; font-size: 16px; }
  select, input[type="text"] { font-size: 16px; padding: 5px; margin: 5px 0; }
  button { padding: 10px 20px; margin-top: 10px; font-size: 16px; }
  #chatContainer { 
    background: #f0f0f0; 
    padding: 10px; 
    white-space: pre-wrap; 
    word-wrap: break-word; 
    font-size: 16px; 
    max-height: 400px; 
    overflow-y: auto; 
    border: 1px solid #ccc;
  }
  .user { color: #d14; font-weight: bold; margin-bottom: 5px; }
  .character { color: #2a7ae2; font-weight: bold; margin-bottom: 5px; }
  .message { margin-bottom: 10px; }
</style>
</head>
<body>
<h1>AI キャラクター連続対話テスト</h1>

<label>質問：</label>
<textarea id="userInput">AIとは何か？</textarea><br>

<label>キャラクター：</label>
<select id="characterInput">
  <option>ドラえもん</option>
  <option>スヌーピー</option>
  <option>ガンダム</option>
  <option>リラックマ</option>
</select><br>

<label>トーン：</label>
<select id="toneInput">
  <option>優しく</option>
  <option>真面目に</option>
  <option>面白く</option>
  <option>冷静に</option>
</select><br>

<button id="sendBtn">送信</button>
<button id="clearBtn">会話履歴クリア</button>

<h2>会話結果</h2>
<div id="chatContainer">ここに結果が表示されます</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const chatContainer = document.getElementById("chatContainer");

function addMessage(role, text) {
  const div = document.createElement('div');
  div.className = 'message ' + (role === 'user' ? 'user' : 'character');
  div.innerHTML = `<strong>${role}:</strong> ${text}`;
  chatContainer.appendChild(div);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

document.getElementById("sendBtn").addEventListener("click", async () => {
  const userInput = document.getElementById("userInput").value;
  const character = document.getElementById("characterInput").value;
  const tone = document.getElementById("toneInput").value;
  if (!userInput.trim()) return;

  addMessage('あなた', userInput);
  document.getElementById("userInput").value = '';

  try {
    const resp = await axios.post('http://localhost:3000/api/groq', { userInput, character, tone });
    addMessage(`${character} (${tone})`, resp.data.content);
  } catch (e) {
    addMessage('⚠️ エラー', e.message);
  }
});

// 会話履歴クリア
document.getElementById("clearBtn").addEventListener("click", async () => {
  try {
    await axios.post('http://localhost:3000/api/clear');
    chatContainer.innerHTML = '<em>会話履歴をクリアしました</em>';
  } catch (e) {
    addMessage('⚠️ エラー', e.message);
  }
});
</script>
</body>
</html>
